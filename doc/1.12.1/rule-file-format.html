<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libxkbcommon: The rules file</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libxkbcommon<span id="projectnumber">&#160;1.12.1</span>
   </div>
   <div id="projectbrief">Library implementing the XKB specification for parsing                           keyboard descriptions and handling keyboard state</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">The rules file </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#format-of-the-file">Format of the file </a>
    <ul>
      <li class="level2">
        <a href="#rule-def">Rules and rule sets </a>
      </li>
      <li class="level2">
        <a href="#rules-group-def">Groups </a>
      </li>
      <li class="level2">
        <a href="#rules-wildcard-def">Wild cards </a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#grammar">Grammar </a>
  </li>
  <li class="level1">
    <a href="#rmlvo-resolution">RMLVO resolution process </a>
    <ul>
      <li class="level2">
        <a href="#process">Process </a>
      </li>
      <li class="level2">
        <a href="#examples">Examples </a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_2rules-format"></a></p>
<p>The purpose of the rules file is to map between configuration values that are easy for a user to specify and understand, and the configuration values that the keymap compiler, <span class="tt">xkbcomp</span>, uses and understands. The following diagram presents an overview of this process. See the <a class="el" href="xkb-intro.html">XKB introduction</a> for further details on the components.</p>
<div class="dotgraph">
<iframe scrolling="no" loading="lazy" frameborder="0" src="dot_xkb-configuration.svg" width="851" height="679"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe><div class="caption">
XKB keymap configurations</div>
</div>
<p><span class="tt">libxkbcommon</span>’s keymap compiler <span class="tt">xkbcomp</span> uses the <span class="tt"><a class="el" href="structxkb__component__names.html" title="Keymap components, also known as KcCGST.">xkb_component_names</a></span> struct internally, which maps directly to <a class="el" href="keymap-text-format-v1-v2.html#xkb-include">include statements</a> of the appropriate <a class="el" href="keymap-text-format-v1-v2.html#keymap-section-def">sections</a> (called <a class="el" href="xkb-intro.html#KcCGST-intro">KcCGST</a> for short):</p>
<ul>
<li><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_keycodes-section">key codes</a>,</li>
<li><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_compat-section">compatibility</a>,</li>
<li>geometry (<a class="el" href="xkbcommon-compatibility.html#geometry-support">not supported</a> by xkbcommon),</li>
<li><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_symbols-section">symbols</a>,</li>
<li><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_types-section">types</a>.</li>
</ul>
<p>These are not really intuitive nor straightforward for the uninitiated. Instead, the user passes in a <span class="tt"><a class="el" href="structxkb__rule__names.html" title="Names to compile a keymap with, also known as RMLVO.">xkb_rule_names</a></span> struct, which consists of the following fields (called <a class="el" href="xkb-intro.html#RMLVO-intro">RMLVO</a> for short):</p>
<ul>
<li>the name of a <a class="el" href="xkb-intro.html#config-rules-def">rules</a> file (in Linux this is usually “evdev”),</li>
<li>a keyboard <a class="el" href="xkb-intro.html#config-model-def">model</a> (e.g. “pc105”),</li>
<li>a set of <a class="el" href="xkb-intro.html#config-layout-def">layouts</a> (which will end up in different groups, e.g. “us,fr”),</li>
<li>a set of <a class="el" href="xkb-intro.html#config-variant-def">variants</a> (used to alter/augment the respective layout, e.g. “intl,dvorak”),</li>
<li>a set of <a class="el" href="xkb-intro.html#config-options-def">options</a> (used to tweak some general behavior of the keyboard, e.g. “ctrl:nocaps,compose:menu” to make the Caps Lock key act like Ctrl and the Menu key like Compose).</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="format-of-the-file"></a>
Format of the file</h1>
<h2 class="doxsection"><a class="anchor" id="rule-def"></a>
Rules and rule sets</h2>
<p><a class="anchor" id="rule-set-def"></a>The file consists of <b>rule sets</b>, each consisting of <b>rules</b> (one per line), which match the <a class="el" href="xkb-intro.html#RMLVO-intro">MLVO</a> values on the left hand side, and, if the values match to the values the user passed in, results in the values on the right hand side being <a class="el" href="#rules-kccgst-value-update">added</a> to the resulting <a class="el" href="xkb-intro.html#KcCGST-intro">KcCGST</a>. See <a class="el" href="#rmlvo-resolution">RMLVO resolution process</a> for further details.</p>
<div class="fragment"><div class="line"><span class="comment">// This is a comment</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following line is a rule header.</span></div>
<div class="line"><span class="comment">// It starts with ‘!’ and introduces a rules set.</span></div>
<div class="line"><span class="comment">// It indicates that the rules map MLVO options to KcCGST symbols.</span></div>
<div class="line">! option       = symbols</div>
<div class="line">  <span class="comment">// The following lines are rules that add symbols of the RHS when the</span></div>
<div class="line">  <span class="comment">// LHS matches an option.</span></div>
<div class="line">  ctrl:nocaps  = +ctrl(nocaps)</div>
<div class="line">  compose:menu = +compose(menu)</div>
<div class="line"> </div>
<div class="line"><span class="comment">// One may use multiple MLVO components on the LHS</span></div>
<div class="line">! layout    option          = symbols</div>
<div class="line">  be        caps:digits_row = +capslock(digits_row)</div>
<div class="line">  fr        caps:digits_row = +capslock(digits_row)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="rules-group-def"></a>
Groups</h2>
<p>Since some values are related and repeated often, it is possible to <em>group</em> them together and refer to them by a <b>group name</b> in the rules.</p>
<div class="fragment"><div class="line"><span class="comment">// Let’s rewrite the previous rules set using groups.</span></div>
<div class="line"><span class="comment">// Groups starts with ‘$’.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a group for countries with AZERTY layouts</span></div>
<div class="line">! $azerty = be fr</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following rule will match option `caps:digits_row` only for</span></div>
<div class="line"><span class="comment">// layouts in the $azerty group, i.e. `fr` and `be`.</span></div>
<div class="line">! layout    option          = symbols</div>
<div class="line"> $azerty    caps:digits_row = +capslock(digits_row)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="rules-wildcard-def"></a>
Wild cards</h2>
<p>Along with matching values by simple string equality and for membership in a <a class="el" href="#rules-group-def">group</a> defined previously, rules may also contain <b>wild card</b> values with the following behavior:</p>
<dl>
<dt>*<a class="anchor" id="rules-wildcard-legacy-def"></a> </dt>
<dd><p class="startdd"></p>
<p class="interdd">Legacy wild card:</p><ul>
<li>For <span class="tt">model</span> and <span class="tt">options</span>: <em>always</em> match.</li>
<li>For <span class="tt">layout</span> and <span class="tt">variant</span>: match any <em>non-empty</em> value.</li>
</ul>
<p class="interdd">This wild card usually appears near the end of a rule set to set <em>default</em> values.</p>
<dl class="section note"><dt>Note</dt><dd>Prefer using the wild cards <a class="el" href="#rules-wildcard-some-def">&lt;some&gt;</a> or <a class="el" href="#rules-wildcard-any-def">&lt;any&gt;</a> for their simpler semantics, as it does not depend on the context.  </dd></dl>
</dd>
<dt>&lt;none&gt;<a class="anchor" id="rules-wildcard-none-def"></a> </dt>
<dd><p class="startdd"></p>
<p class="interdd">Match <em>empty</em> values</p>
<dl class="section since"><dt>Since</dt><dd>1.9.0  </dd></dl>
</dd>
<dt>&lt;some&gt;<a class="anchor" id="rules-wildcard-some-def"></a> </dt>
<dd><p class="startdd"></p>
<p class="interdd">Match <em>non-empty</em> value</p>
<dl class="section since"><dt>Since</dt><dd>1.9.0  </dd></dl>
</dd>
<dt>&lt;any&gt;<a class="anchor" id="rules-wildcard-any-def"></a> </dt>
<dd><p class="startdd"></p>
<p class="interdd">Match <em>any</em> (optionally empty) value. Its behavior does not depend on the context, contrary to the legacy wild card <a class="el" href="#rules-wildcard-legacy-def">*</a>.</p>
<p class="interdd">This wild card usually appears near the end of a rule set to set <em>default</em> values.</p>
<dl class="section since"><dt>Since</dt><dd>1.9.0  </dd></dl>
</dd>
</dl>
<div class="fragment"><div class="line">! layout = keycodes</div>
<div class="line">  <span class="comment">// The following two lines only match exactly their respective groups.</span></div>
<div class="line"> $azerty = +aliases(azerty)</div>
<div class="line"> $qwertz = +aliases(qwertz)</div>
<div class="line">  <span class="comment">// This line will match layouts that are neither in $azerty nor in</span></div>
<div class="line">  <span class="comment">// $qwertz groups.</span></div>
<div class="line">  *      = +aliases(qwerty)</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="grammar"></a>
Grammar</h1>
<p>It is advised to look at a file like <span class="tt">rules/evdev</span> along with this grammar.</p>
<dl class="section note"><dt>Note</dt><dd>Comments, whitespace, etc. are not shown.</dd></dl>
<div class="fragment"><div class="line">File         ::= { &quot;!&quot; (Include | Group | RuleSet) }</div>
<div class="line"> </div>
<div class="line">Include      ::= &quot;include&quot; &lt;ident&gt;</div>
<div class="line"> </div>
<div class="line">Group        ::= GroupName &quot;=&quot; { GroupElement } &quot;\n&quot;</div>
<div class="line">GroupName    ::= &quot;$&quot;&lt;ident&gt;</div>
<div class="line">GroupElement ::= &lt;ident&gt;</div>
<div class="line"> </div>
<div class="line">RuleSet      ::= Mapping { Rule }</div>
<div class="line"> </div>
<div class="line">Mapping      ::= { Mlvo } &quot;=&quot; { Kccgst } &quot;\n&quot;</div>
<div class="line">Mlvo         ::= &quot;model&quot; | &quot;option&quot; | (&quot;layout&quot; | &quot;variant&quot;) [ Index ]</div>
<div class="line">Index        ::= &quot;[&quot; ({ NumericIndex } | { SpecialIndex }) &quot;]&quot;</div>
<div class="line">NumericIndex ::= 1..XKB_MAX_GROUPS</div>
<div class="line">SpecialIndex ::= &quot;single&quot; | &quot;first&quot; | &quot;later&quot; | &quot;any&quot;</div>
<div class="line">Kccgst       ::= &quot;keycodes&quot; | &quot;symbols&quot; | &quot;types&quot; | &quot;compat&quot; | &quot;geometry&quot;</div>
<div class="line"> </div>
<div class="line">Rule         ::= { MlvoValue } &quot;=&quot; { KccgstValue } &quot;\n&quot;</div>
<div class="line">MlvoValue    ::= &quot;*&quot; | &quot;&lt;none&gt;&quot; | &quot;&lt;some&gt;&quot; | &quot;&lt;any&gt;&quot; | GroupName | &lt;ident&gt;</div>
<div class="line">KccgstValue  ::= &lt;ident&gt; [ { Qualifier } ]</div>
<div class="line">Qualifier    ::= &quot;:&quot; ({ NumericIndex } | &quot;all&quot;)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>Include processes the rules in the file path specified in the <span class="tt">ident</span>, in order. <b>%-expansion</b> is performed, as follows:<a class="anchor" id="rules-include-expansion"></a> <dl>
<dt><span class="tt">%%</span> </dt>
<dd>A literal %. </dd>
<dt><code>%H</code> </dt>
<dd>The value of the <span class="tt">$HOME</span> environment variable. </dd>
<dt><code>%E</code> </dt>
<dd>The extra lookup path for system-wide XKB data (usually <span class="tt">/etc/xkb/rules</span>).  </dd>
<dt><code>%S</code> </dt>
<dd>The system-installed rules directory (usually <span class="tt">/usr/share/X11/xkb/rules</span>).  </dd>
</dl>
<b>Note:</b> This feature is supported by libxkbcommon but not by the legacy X11 tools.</li>
<li><p class="startli"><a class="anchor" id="rules-extended-layout-indices"></a> (Since version <span class="tt">1.8.0</span>) The following <em>extended layout indices</em> can be used to avoid repetition and clarify the semantics:</p>
<dl>
<dt><span class="tt">single</span> </dt>
<dd>Matches a single layout; <span class="tt">layout[single]</span> is the same as without explicit index: <span class="tt">layout</span>.  </dd>
<dt><span class="tt">first</span> </dt>
<dd>Matches the first layout/variant, no matter how many layouts are in the RMLVO configuration. Acts as both <span class="tt">layout</span> and <span class="tt">layout[1]</span>.  </dd>
<dt><span class="tt">later</span> </dt>
<dd>Matches all but the first layout. This is an index <em>range</em>. Acts as <span class="tt">layout[2]</span> .. <span class="tt">layout[4]</span>.  </dd>
<dt>any </dt>
<dd>Matches layout at any position. This is an index <em>range</em>. Acts as <span class="tt">layout</span>, <span class="tt">layout[1]</span> .. <span class="tt">layout[4]</span>.  </dd>
</dl>
<p class="startli">When using a layout index <em>range</em> (<span class="tt">later</span>, <span class="tt">any</span>), the <a class="el" href="#rules-i-expansion">%i expansion</a> can be used in the <span class="tt">KccgstValue</span> to refer to the index of the matched layout.</p>
</li>
<li>The order of values in a <span class="tt">Rule</span> must be the same as the <span class="tt">Mapping</span> it follows. The mapping line determines the meaning of the values in the rules which follow in the <span class="tt">RuleSet</span>.</li>
<li><p class="startli">If a <span class="tt">Rule</span> is matched, <b>%-expansion</b> is performed on the <span class="tt">KccgstValue</span>, as follows:</p>
<dl>
<dt><code>%m</code>, <code>%l</code>, <code>%v</code> </dt>
<dd>The <a class="el" href="xkb-intro.html#config-model-def">model</a>, <a class="el" href="xkb-intro.html#config-layout-def">layout</a> or <a class="el" href="xkb-intro.html#config-variant-def">variant</a>, if <em>only one</em> was given (e.g. <code>%l</code> for “us,il” is invalid).  </dd>
<dt><code>%l[1]</code>, <code>%l[2]</code>, …, <code>%v[1]</code>, <code>%v[2]</code>, …  </dt>
<dd><a class="el" href="xkb-intro.html#config-layout-def">Layout</a> or <a class="el" href="xkb-intro.html#config-variant-def">variant</a> for the specified layout <span class="tt">Index</span>, if <em>more than one</em> was given, e.g.: <code>%l[1]</code> is invalid for “us” but expands to “us” for “us,de”.  </dd>
<dt><span class="tt">%+m</span>, <span class="tt">%+l</span>, <span class="tt">%+l[1]</span>, <span class="tt">%+l[2]</span>, …, <span class="tt">%+v</span>, <span class="tt">%+v[1]</span>, <span class="tt">%+v[2]</span>, …  </dt>
<dd>As above, but prefixed with ‘+’. Similarly, ‘|’, ‘^’, ‘-’, ‘_’ may be used instead of ‘+’. See the <a class="el" href="keymap-text-format-v1-v2.html#merge-mode-def">merge mode</a> documentation for the special meaning of ‘+’, ‘|’ and ‘^’.  </dd>
<dt><span class="tt">%(m)</span>, <span class="tt">%(l)</span>, <span class="tt">%(l[1])</span>, <span class="tt">%(l[2])</span>, …, <span class="tt">%(v)</span>, <span class="tt">%(v[1])</span>, <span class="tt">%(v[2])</span>, …  </dt>
<dd>As above, but prefixed by ‘(’ and suffixed by ‘)’.  </dd>
<dt><a class="anchor" id="rules-i-expansion"></a> <span class="tt">:%i</span>, <span class="tt">%l[%i]</span>, <span class="tt">%(l[%i])</span>, etc.  </dt>
<dd><p class="startdd">In case the mapping uses an <a class="el" href="#rules-extended-layout-indices">extended layout index</a>, <span class="tt">%i</span> corresponds to the index of the matched layout.</p>
<p class="enddd">ℹ️ Notes:</p><ul>
<li>Added in version <span class="tt">1.8.0</span></li>
<li>Since <span class="tt">1.11.0</span>: This feature can only be used if the rule header has a <span class="tt">layout</span> or <span class="tt">variant</span> <a class="el" href="xkb-intro.html#RMLVO-intro">MLVO</a> field. </li>
</ul>
</dd>
</dl>
<p class="startli">In case the expansion is <em>invalid</em>, as described above, it is <em>skipped</em> (the rest of the string is still processed); this includes the prefix and suffix. This is why one should use e.g. <code>%(v[1])</code> instead of <code>(%v[1])</code>. See <a class="el" href="#rules-symbols-example">Example: layouts, variants and symbols</a> for an illustration.</p>
</li>
<li><p class="startli"><a class="anchor" id="rules-all-qualifier"></a> (Since version <span class="tt">1.8.0</span>) If a <span class="tt">Rule</span> is matched, the <span class="tt">:all</span> <em>qualifier</em> in the <span class="tt">KccgstValue</span> applies the qualified value (and its optional merge mode) to all layouts. If there is no merge mode, it defaults to <em>override</em> <span class="tt">+</span>.</p>
<table class="doxtable">
<caption>Examples of <span class="tt">:all</span> qualified use</caption>
<tr>
<th><span class="tt">KccgstValue</span></th><th>Layouts count</th><th>Final <span class="tt">KccgstValue</span></th></tr>
<tr>
<td rowspan="2"><span class="tt">x:all</span></td><td>1</td><td><span class="tt">x:1</span></td></tr>
<tr>
<td>2</td><td><span class="tt">x:1+x:2</span></td></tr>
<tr>
<td rowspan="2"><span class="tt">+x:all</span></td><td>1</td><td><span class="tt">+x:1</span></td></tr>
<tr>
<td>3</td><td><span class="tt">+x:1+x:2+x:3</span></td></tr>
<tr>
<td rowspan="2"><span class="tt">|x:all</span></td><td>1</td><td><span class="tt">|x:1</span></td></tr>
<tr>
<td>4</td><td><span class="tt">|x:1|x:2|x:3|x:4</span></td></tr>
<tr>
<td rowspan="2"><span class="tt">x|y:all</span></td><td>1</td><td><span class="tt">x|y:1</span></td></tr>
<tr>
<td>3</td><td><span class="tt">x|y:1|y:2|y:3</span></td></tr>
<tr>
<td><span class="tt">x:all+y|z:all</span></td><td>2</td><td><span class="tt">x:1+x:2+y|z:1|z:2</span></td></tr>
</table>
</li>
</ul>
</dd></dl>
<h1 class="doxsection"><a class="anchor" id="rmlvo-resolution"></a>
RMLVO resolution process</h1>
<h2 class="doxsection"><a class="anchor" id="process"></a>
Process</h2>
<p>First of all, the rules <em>file</em> is extracted from the provided <a class="el" href="xkb-intro.html#RMLVO-intro"><em>R</em>MLVO</a> configuration (usually <span class="tt">evdev</span>). Then its path is resolved and the file is parsed to get the <a class="el" href="#rule-set-def">rule sets</a>.</p>
<p>Then <em>each rule set</em> is checked against the provided <a class="el" href="xkb-intro.html#RMLVO-intro">MLVO</a> configuration, following their <em>order</em> in the rules file.</p>
<dl class="section important"><dt>Important</dt><dd><a class="anchor" id="irrelevant-options-order"></a>Contrary to layouts and variants, the <em>options order</em> in a <a class="el" href="xkb-intro.html#RMLVO-intro">MLVO</a> configuration (e.g. via <span class="tt">xkbcli</span>) is irrelevant for its resolution: only the order of the rules matters. See “<a class="el" href="#rules-options-example">Example: layout, option and symbols</a>” for an illustration.</dd></dl>
<p>If a <a class="el" href="#rule-def">rule</a> matches in a <a class="el" href="#rule-set-def">rule set</a>, then:</p>
<ol>
<li>
<p class="startli"><a class="anchor" id="rules-kccgst-value-update"></a> The <em>KcCGST</em> value of the rule is used to update the <a class="el" href="xkb-intro.html#KcCGST-intro">KcCGST</a> configuration, using the following instructions. Note that <span class="tt">foo</span> and <span class="tt">bar</span> are placeholders; ‘+’ specifies the <em>override</em> <a class="el" href="keymap-text-format-v1-v2.html#merge-mode-def">merge mode</a> and can be replaced by ‘|’ or ‘^’ to specify respectively the <em>augment</em> or <em>replace</em> merge mode instead.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Rule value  </th><th class="markdownTableHeadNone">Old KcCGST value  </th><th class="markdownTableHeadNone">New KcCGST value  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">bar</span>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><span class="tt">bar</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">bar</span>  </td><td class="markdownTableBodyNone"><span class="tt">foo</span>  </td><td class="markdownTableBodyNone"><span class="tt">foo</span> (<em>skip</em> <span class="tt">bar</span>)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">bar</span>  </td><td class="markdownTableBodyNone"><span class="tt">+foo</span>  </td><td class="markdownTableBodyNone"><span class="tt">bar+foo</span> (<em>prepend</em>)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">+bar</span>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><span class="tt">+bar</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">+bar</span>  </td><td class="markdownTableBodyNone"><span class="tt">foo</span>  </td><td class="markdownTableBodyNone"><span class="tt">foo+bar</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">+bar</span>  </td><td class="markdownTableBodyNone"><span class="tt">+foo</span>  </td><td class="markdownTableBodyNone"><span class="tt">+foo+bar</span>  </td></tr>
</table>
</li>
<li>
The rest of the set will be <em>skipped</em>, except if the set matches against <a class="el" href="xkb-intro.html#config-options-def">options</a>. Indeed, those may contain <em>multiple</em> legitimate rules, so they are processed entirely. See <a class="el" href="#rules-options-example">Example: layout, option and symbols</a> for an illustration.  </li>
</ol>
<h2 class="doxsection"><a class="anchor" id="examples"></a>
Examples</h2>
<h3 class="doxsection"><a class="anchor" id="example-key-codes"></a>
Example: key codes</h3>
<p>Using the following example:</p>
<div class="fragment"><div class="line">! $jollamodels = jollasbj</div>
<div class="line">! $azerty = be fr</div>
<div class="line">! $qwertz = al ch cz de hr hu ro si sk</div>
<div class="line"> </div>
<div class="line">! model       = keycodes</div>
<div class="line"> $jollamodels = evdev+jolla(jolla)</div>
<div class="line">  olpc        = evdev+olpc(olpc)</div>
<div class="line">  *           = evdev</div>
<div class="line"> </div>
<div class="line">! layout      = keycodes</div>
<div class="line"> $azerty      = +aliases(azerty)</div>
<div class="line"> $qwertz      = +aliases(qwertz)</div>
<div class="line">  *           = +aliases(qwerty)</div>
</div><!-- fragment --><p>we would have the following resolutions of <em><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_keycodes-section">key codes</a></em>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Model  </th><th class="markdownTableHeadCenter">Layout  </th><th class="markdownTableHeadLeft">Keycodes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">jollasbj</span>  </td><td class="markdownTableBodyCenter"><span class="tt">us</span>  </td><td class="markdownTableBodyLeft"><span class="tt">evdev+jolla(jolla)+aliases(qwerty)</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">olpc</span>  </td><td class="markdownTableBodyCenter"><span class="tt">be</span>  </td><td class="markdownTableBodyLeft"><span class="tt">evdev+olpc(olpc)+aliases(azerty)</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">pc</span>  </td><td class="markdownTableBodyCenter"><span class="tt">al</span>  </td><td class="markdownTableBodyLeft"><span class="tt">evdev+aliases(qwertz)</span>  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="rules-symbols-example"></a>
Example: layouts, variants and symbols</h3>
<p>Using the following example:</p>
<div class="fragment"><div class="line">! layout    = symbols</div>
<div class="line">  *         = pc+%l%(v)</div>
<div class="line"><span class="comment">// The following would not work: syntax for *multiple* layouts</span></div>
<div class="line"><span class="comment">// in a rule set for *single* layout.</span></div>
<div class="line"><span class="comment">//*         = pc+%l[1]%(v[1])</span></div>
<div class="line"> </div>
<div class="line">! layout[1] = symbols</div>
<div class="line">  *         = pc+%l[1]%(v[1])</div>
<div class="line"><span class="comment">// The following would not work: syntax for *single* layout</span></div>
<div class="line"><span class="comment">// in a rule set for *multiple* layouts.</span></div>
<div class="line"><span class="comment">//*         = pc+%l%(v)</span></div>
<div class="line"> </div>
<div class="line">! layout[2] = symbols</div>
<div class="line">  *         = +%l[2]%(v[2]):2</div>
<div class="line"> </div>
<div class="line">! layout[3] = symbols</div>
<div class="line">  *         = +%l[3]%(v[3]):3</div>
</div><!-- fragment --><p>we would have the following resolutions of <em><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_symbols-section">symbols</a></em>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Layout  </th><th class="markdownTableHeadNone">Variant  </th><th class="markdownTableHeadNone">Symbols  </th><th class="markdownTableHeadNone">Rules sets used  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">us</span>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><span class="tt">pc+us</span>  </td><td class="markdownTableBodyNone">#1  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">us</span>  </td><td class="markdownTableBodyNone"><span class="tt">intl</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+us(intl)</span>  </td><td class="markdownTableBodyNone">#1  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">us,es</span>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><span class="tt">pc+us+es:2</span>  </td><td class="markdownTableBodyNone">#2, #3  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">us,es,fr</span>  </td><td class="markdownTableBodyNone"><span class="tt">intl,,bepo</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+us(intl)+es:2+fr(bepo):3</span>  </td><td class="markdownTableBodyNone">#2, #3, #4  </td></tr>
</table>
<p>Since version <span class="tt">1.8.0</span>, the previous code can be replaced with simply:</p>
<div class="fragment"><div class="line">! layout[first] = symbols</div>
<div class="line">  *             = pc+%l[%i]%(v[%i])</div>
<div class="line"> </div>
<div class="line">! layout[later] = symbols</div>
<div class="line">  *             = +%l[%i]%(v[%i]):%i</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="rules-options-example"></a>
Example: layout, option and symbols</h3>
<p>Using the following example:</p>
<div class="fragment"><div class="line">! $azerty = be fr</div>
<div class="line"> </div>
<div class="line">! layout = symbols</div>
<div class="line">  *      = pc+%l%(v)</div>
<div class="line"> </div>
<div class="line">! layout[1] = symbols</div>
<div class="line">  *         = pc+%l[1]%(v[1])</div>
<div class="line"> </div>
<div class="line">! layout[2] = symbols</div>
<div class="line">  *         = +%l[2]%(v[2])</div>
<div class="line"><span class="comment">// Repeat the previous rules set with indices 3 and 4</span></div>
<div class="line"> </div>
<div class="line">! layout     option          = symbols</div>
<div class="line"> $azerty     caps:digits_row = +capslock(digits_row)</div>
<div class="line">  *          misc:typo       = +typo(base)</div>
<div class="line">  *          lv3:ralt_alt    = +level3(ralt_alt)</div>
<div class="line"> </div>
<div class="line">! layout[1]  option          = symbols</div>
<div class="line"> $azerty     caps:digits_row = +capslock(digits_row):1</div>
<div class="line">  *          misc:typo       = +typo(base):1</div>
<div class="line">  *          lv3:ralt_alt    = +level3(ralt_alt):1</div>
<div class="line"><span class="comment">// Repeat the previous rules set for indices 2 to 4</span></div>
</div><!-- fragment --><p>we would have the following resolutions of <em><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_symbols-section">symbols</a></em>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Layout  </th><th class="markdownTableHeadNone">Option  </th><th class="markdownTableHeadNone">Symbols  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">be</span>  </td><td class="markdownTableBodyNone"><span class="tt">caps:digits_row</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+capslock(digits_row)</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">caps:digits_row</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+gb</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">fr</span>  </td><td class="markdownTableBodyNone"><span class="tt">misc:typo</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+fr+typo(base)</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">fr</span>  </td><td class="markdownTableBodyNone"><span class="tt">misc:typo,caps:digits_row</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+fr+capslock(digits_row)+typo(base)</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">fr</span>  </td><td class="markdownTableBodyNone"><span class="tt">lv3:ralt_alt,caps:digits_row,misc:typo</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+fr+capslock(digits_row)+typo(base)+level3(ralt_alt)</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">fr,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">caps:digits_row,misc:typo</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+fr+gb:2+capslock(digits_row)+typo(base):1+typo(base):2</span>  </td></tr>
</table>
<p>Note that the configuration with <span class="tt">gb</span> <a class="el" href="xkb-intro.html#config-layout-def">layout</a> has no match for the <a class="el" href="xkb-intro.html#config-options-def">option</a> <span class="tt">caps:digits_row</span> and that the order of the <a class="el" href="xkb-intro.html#config-options-def">options</a> in the <a class="el" href="xkb-intro.html#RMLVO-intro">RMLVO</a> configuration has no influence on the resulting <a class="el" href="keymap-text-format-v1-v2.html#the-xkb_symbols-section">symbols</a>, as it depends solely on their order in the rules.</p>
<p>Since version <span class="tt">1.8.0</span>, the previous code can be replaced with simply:</p>
<div class="fragment"><div class="line">! $azerty = be fr</div>
<div class="line"> </div>
<div class="line">! layout[first] = symbols</div>
<div class="line">  *             = pc+%l[%i]%(v[%i])</div>
<div class="line"> </div>
<div class="line">! layout[later] = symbols</div>
<div class="line">  *             = +%l[%i]%(v[%i])</div>
<div class="line"> </div>
<div class="line">! layout[any]  option          = symbols</div>
<div class="line"> $azerty       caps:digits_row = +capslock(digits_row):%i</div>
<div class="line"> </div>
<div class="line">! option       = symbols</div>
<div class="line">  misc:typo    = +typo(base):all</div>
<div class="line">  lv3:ralt_alt = +level3(ralt_alt):all</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The previous is equivalent to:</span></div>
<div class="line">! layout[any]  option       = symbols</div>
<div class="line">  *            misc:typo    = +typo(base):%i</div>
<div class="line">  *            lv3:ralt_alt = +level3(ralt_alt):%i</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="rules-layout-specific-options-example"></a>
Example: layout-specific options</h3>
<p>Using the following example:</p>
<div class="fragment"><div class="line">! layout[first] = symbols</div>
<div class="line">  *             = pc</div>
<div class="line"> </div>
<div class="line">! layout[any] = symbols</div>
<div class="line">  *           = %l[%i]%(v[%i])</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Not layout-specific</span></div>
<div class="line">! option      = symbols</div>
<div class="line">  opt1        = +opt1</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Layout-specific: note the range `[any]` and the `:%i` specifier</span></div>
<div class="line">! layout[any]   option     = symbols</div>
<div class="line">  *             opt2       = +opt2:%i</div>
</div><!-- fragment --><p>we would have the following resolutions of <em><a class="el" href="keymap-text-format-v1-v2.html#the-xkb_symbols-section">symbols</a></em>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Layout  </th><th class="markdownTableHeadNone">Option  </th><th class="markdownTableHeadNone">Symbols  </th><th class="markdownTableHeadNone">Comment  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt1</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2+opt1</span>  </td><td class="markdownTableBodyNone">Matched: no layout index  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt1!1</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2</span>  </td><td class="markdownTableBodyNone">No match: not a layout-specific option  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt1!2</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2</span>  </td><td class="markdownTableBodyNone">No match: not a layout-specific option  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt2</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2+opt2:1+opt2:2</span>  </td><td class="markdownTableBodyNone">Matched: all layouts  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt2!1</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2+opt2:1</span>  </td><td class="markdownTableBodyNone">Matched: only specified layout  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">be,gb</span>  </td><td class="markdownTableBodyNone"><span class="tt">opt2!2</span>  </td><td class="markdownTableBodyNone"><span class="tt">pc+be+gb:2+opt2:2</span>  </td><td class="markdownTableBodyNone">Matched: only specified layout  </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Such option should use the attribute <span class="tt">layout-specific="true"</span> in the corresponding <span class="tt">configItem</span> tag of the XML registry file, so that keyboard configuration can expose this feature in their user interface. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
