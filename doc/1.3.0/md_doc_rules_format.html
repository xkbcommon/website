<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libxkbcommon: The rules file</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libxkbcommon
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The rules file </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of the rules file is to map between configuration values that are easy for a user to specify and understand, and the configuration values xkbcomp uses and understands.</p>
<p>xkbcomp uses the xkb_component_names struct, which maps directly to include statements of the appropriate sections, called for short KcCGST (see doc/keymap-format-text-v1.txt; 'G' stands for "geometry", which is not supported). These are not really intuitive or straight- forward for the uninitiated.</p>
<p>Instead, the user passes in a <a class="el" href="structxkb__rule__names.html" title="Names to compile a keymap with, also known as RMLVO.">xkb_rule_names</a> struct, which consists of the name of a rules file (in Linux this is usually "evdev"), a keyboard model (e.g. "pc105"), a set of layouts (which will end up in different groups, e.g. "us,fr"), variants (used to alter/augment the respective layout, e.g. "intl,dvorak"), and a set of options (used to tweak some general behavior of the keyboard, e.g. "ctrl:nocaps,compose:menu" to make the Caps Lock key act like Ctrl and the Menu key like Compose). We call these RMLVO.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Format of the file</h1>
<p>The file consists of rule sets, each consisting of rules (one per line), which match the MLVO values on the left hand side, and, if the values match to the values the user passed in, results in the values on the right hand side being added to the resulting KcCGST. Since some values are related and repeated often, it is possible to group them together and refer to them by a group name in the rules.</p>
<p>Along with matching values by simple string equality, and for membership in a group defined previously, rules may also contain "wildcard" values - "*" - which always match. These usually appear near the end.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Grammar</h1>
<p>(It might be helpful to look at a file like rules/evdev along with this grammar. Comments, whitespace, etc. are not shown.)</p>
<div class="fragment"><div class="line">File         ::= { &quot;!&quot; (Include | Group | RuleSet) }</div>
<div class="line"> </div>
<div class="line">Include      ::= &quot;include&quot; &lt;ident&gt;</div>
<div class="line"> </div>
<div class="line">Group        ::= GroupName &quot;=&quot; { GroupElement } &quot;\n&quot;</div>
<div class="line">GroupName    ::= &quot;$&quot;&lt;ident&gt;</div>
<div class="line">GroupElement ::= &lt;ident&gt;</div>
<div class="line"> </div>
<div class="line">RuleSet      ::= Mapping { Rule }</div>
<div class="line"> </div>
<div class="line">Mapping      ::= { Mlvo } &quot;=&quot; { Kccgst } &quot;\n&quot;</div>
<div class="line">Mlvo         ::= &quot;model&quot; | &quot;option&quot; | (&quot;layout&quot; | &quot;variant&quot;) [ Index ]</div>
<div class="line">Index        ::= &quot;[&quot; 1..XKB_NUM_GROUPS &quot;]&quot;</div>
<div class="line">Kccgst       ::= &quot;keycodes&quot; | &quot;symbols&quot; | &quot;types&quot; | &quot;compat&quot; | &quot;geometry&quot;</div>
<div class="line"> </div>
<div class="line">Rule         ::= { MlvoValue } &quot;=&quot; { KccgstValue } &quot;\n&quot;</div>
<div class="line">MlvoValue    ::= &quot;*&quot; | GroupName | &lt;ident&gt;</div>
<div class="line">KccgstValue  ::= &lt;ident&gt;</div>
</div><!-- fragment --><p>Notes:</p>
<ul>
<li>Include processes the rules in the file path specified in the ident, in order. %-expansion is performed, as follows:</li>
</ul>
<div class="fragment"><div class="line">%%:</div>
<div class="line">  A literal %.</div>
<div class="line"> </div>
<div class="line">%H:</div>
<div class="line">  The value of the HOME environment variable.</div>
<div class="line"> </div>
<div class="line">%E:</div>
<div class="line">  The extra lookup path for system-wide XKB data (usually /etc/xkb/rules).</div>
<div class="line"> </div>
<div class="line">%S:</div>
<div class="line">  The system-installed rules directory (usually /usr/share/X11/xkb/rules).</div>
</div><!-- fragment --><ul>
<li>The order of values in a Rule must be the same as the Mapping it follows. The mapping line determines the meaning of the values in the rules which follow in the RuleSet.</li>
<li>If a Rule is matched, %-expansion is performed on the KccgstValue, as follows:</li>
</ul>
<div class="fragment"><div class="line">%m, %l, %v:</div>
<div class="line">   The model, layout or variant, if only one was given (e.g.</div>
<div class="line">   %l for &quot;us,il&quot; is invalid).</div>
<div class="line"> </div>
<div class="line">%l[1], %v[1]:</div>
<div class="line">   Layout or variant for the specified group Index, if more than</div>
<div class="line">   one was given (e.g. %l[1] for &quot;us&quot; is invalid).</div>
<div class="line"> </div>
<div class="line">%+m, %+l, %+v, %+l[1], %+v[1]</div>
<div class="line">   As above, but prefixed with &#39;+&#39;. Similarly, &#39;|&#39;, &#39;-&#39;, &#39;_&#39; may be</div>
<div class="line">   used instead of &#39;+&#39;.</div>
<div class="line"> </div>
<div class="line">%(m), %(l), %(l[1]), %(v), %(v[1]):</div>
<div class="line">   As above, but prefixed by &#39;(&#39; and suffixed by &#39;)&#39;.</div>
</div><!-- fragment --><p>In case the expansion is invalid, as described above, it is skipped (the rest of the string is still processed); this includes the prefix and suffix (that's why you shouldn't use e.g. "(%v[1])"). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
